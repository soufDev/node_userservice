pipeline:
  build:
    image: node:latest
    commands:
      - npm i -g yarn
      - yarn install
      - yarn sequelize db:migrate
  test:
    image: node:latest
    environment:
     - NODE_ENV=test
    commands:
      - sleep 20
      - npm test

services:
  database:
    image: mysql
    commands:
      - apt-get update
      - apt-get install -y mysql-server
    environment:
      - MYSQL_DATABASE=database_test
      - MYSQL_ROOT_PASSWORD=root
      - HOST_HOSTNAME=database
    ports:
      - 3306:3306
